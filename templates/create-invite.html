{% extends "base.html" %}

{% block title %}招待の作成 | スマートイベントプランナー{% endblock %}

{% block extra_head %}
  {{ super() }}
  <style>
    .invite-layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 22px;
    }

    .email-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .email-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .email-input-group input {
      flex: 1;
    }

    .email-input-group .btn {
      padding: 0.6rem 1rem;
    }
  </style>
{% endblock %}

{% block content %}
  <section class="surface-card">
    <h1>招待を作成</h1>
    <p>イベントの候補期間と時間帯を設定し、参加者にメールで招待を送信します。</p>
    <form id="invitation-form" action="{{ url_for('invite') }}" method="post">
      <div class="input-field">
        <label for="event-title">予定のタイトル</label>
        <input type="text" id="event-title" name="event-title" required>
      </div>

      <div class="form-grid">
        <div class="input-field">
          <label for="start-date">開始日</label>
          <input type="date" id="start-date" name="start-date" required>
        </div>
        <div class="input-field">
          <label for="end-date">終了日</label>
          <input type="date" id="end-date" name="end-date" required>
        </div>
      </div>

      <div class="time-grid" style="margin-bottom: 6px;">
        <div class="input-field">
          <label for="start-time">開始時間帯</label>
          <input type="time" id="start-time" name="start-time" value="20:00" required>
        </div>
        <div class="input-field">
          <label for="end-time">終了時間帯</label>
          <input type="time" id="end-time" name="end-time" value="22:00" required>
        </div>
      </div>

      <div class="invite-layout">
        <div class="input-field">
          <label>招待するメールアドレス</label>
          <div id="email-list" class="email-list">
            <div class="email-input-group">
              <input type="email" name="emails[]" placeholder="guest@example.com" required>
              <button type="button" class="btn btn-secondary" onclick="addEmailInput()">＋</button>
            </div>
          </div>
        </div>
        <div class="input-field">
          <label for="deadline">入力期限</label>
          <input type="datetime-local" id="deadline" name="deadline" required>
          <small style="color: var(--text-muted);">入力期限は記録のみで、送信時に共有されます。</small>
        </div>
      </div>

      <div class="inline-actions" style="justify-content: flex-end;">
        <button type="submit" class="btn btn-primary">招待を送信</button>
      </div>
    </form>
  </section>
{% endblock %}

{% block extra_scripts %}
  {{ super() }}
  <script>
    function addEmailInput() {
      const emailList = document.getElementById('email-list');
      const wrapper = document.createElement('div');
      wrapper.className = 'email-input-group';
      wrapper.innerHTML = `
        <input type="email" name="emails[]" placeholder="guest@example.com" required>
        <button type="button" class="btn btn-ghost" onclick="removeEmailInput(this)">ー</button>
      `;
      emailList.appendChild(wrapper);
    }

    function removeEmailInput(button) {
      const group = button.parentElement;
      group.remove();
    }
  </script>
{% endblock %}
