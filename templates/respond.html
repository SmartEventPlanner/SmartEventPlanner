{% extends "base.html" %}

{% block title %}招待への回答 | スマートイベントプランナー{% endblock %}

{% block extra_head %}
  {{ super() }}
  <style>
    .respond-card {
      max-width: 640px;
      margin: 0 auto;
    }

    .slot-container {
      max-height: 320px;
      overflow-y: auto;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(255, 255, 255, 0.92);
      padding: 18px;
      display: grid;
      gap: 18px;
    }

    .slot-group {
      display: grid;
      gap: 10px;
    }

    .slot-date {
      font-weight: 700;
      color: var(--accent-strong);
    }

    .slot-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      background: rgba(14, 165, 233, 0.1);
      color: var(--text-primary);
      font-weight: 600;
    }

    .respond-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
  </style>
{% endblock %}

{% block header_actions %}{% endblock %}

{% block content %}
  <section class="surface-card form-card respond-card">
    <h1>{{ event.title }}</h1>
    <p>参加可否を選択し、参加できる時間帯があればチェックを入れて送信してください。</p>

    <div class="respond-actions" id="attendance-buttons">
      <button type="button" class="btn btn-primary" onclick="chooseAttend()">参加する</button>
      <form method="post" style="margin: 0;">
        <input type="hidden" name="action" value="decline">
        <button type="submit" class="btn btn-ghost">参加しない</button>
      </form>
    </div>

    <form method="post" id="availability-form" style="display: none;">
      <input type="hidden" name="action" value="attend">
      <div class="slot-container">
        {% for day, slots in time_slots.items() %}
          <div class="slot-group">
            <div class="slot-date">{{ day }}</div>
            {% for slot in slots %}
              <label class="slot-item">
                <input type="checkbox" name="available_slots" value="{{ slot.value }}">
                {{ slot.display }}
              </label>
            {% endfor %}
          </div>
        {% endfor %}
      </div>
      <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px;">希望日時を送信</button>
    </form>
  </section>
{% endblock %}

{% block extra_scripts %}
  {{ super() }}
  <script>
    function chooseAttend() {
      document.getElementById('attendance-buttons').style.display = 'none';
      document.getElementById('availability-form').style.display = 'block';
    }
  </script>
{% endblock %}
