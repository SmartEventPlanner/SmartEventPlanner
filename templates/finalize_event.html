{% extends "base.html" %}

{% block title %}予定の確定 | スマートイベントプランナー{% endblock %}

{% block extra_head %}
  {{ super() }}
  <style>
    .slot-box {
      max-height: 280px;
      overflow-y: auto;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(255, 255, 255, 0.94);
      padding: 18px;
      display: grid;
      gap: 14px;
    }

    .slot-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      background: rgba(14, 165, 233, 0.1);
      font-weight: 600;
      color: var(--text-primary);
    }
  </style>
{% endblock %}

{% block content %}
  <section class="surface-card form-card" style="max-width: 680px;">
    <h1>「{{ event.title }}」予定の確定</h1>
    {% if not choices %}
      <div class="empty-state" style="margin-top: 24px;">
        <h3>まだ参加希望が集まっていません</h3>
        <p>出席者からの回答が揃い次第、再度この画面で確定できます。</p>
      </div>
    {% else %}
      <form method="post">
        <div class="input-field">
          <label for="final_title">確定タイトル</label>
          <input type="text" id="final_title" name="final_title" value="{{ event.title }}" required>
        </div>

        <div class="input-field">
          <label>確定する日時</label>
          <div class="slot-box">
            {% for opt in choices %}
              <label class="slot-item" for="slot-{{ loop.index }}">
                <input type="radio" id="slot-{{ loop.index }}" name="final_datetime" value="{{ opt.iso }}" required>
                {{ opt.display }}（{{ opt.count }}名 参加可）
              </label>
            {% endfor %}
          </div>
        </div>

        <div class="input-field">
          <label for="custom_message">メール本文 (任意)</label>
          <textarea id="custom_message" name="custom_message" placeholder="参加者への連絡事項を入力してください"></textarea>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">この内容で確定 &amp; メール送信</button>
      </form>
    {% endif %}
  </section>
{% endblock %}
